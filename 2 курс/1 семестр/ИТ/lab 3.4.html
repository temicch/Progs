<html>
 <head>
 <title>Лабораторная работа 3.4</title>
 <script language="JavaScript"> 
var mainTable = -1;
var subject;
//var xmldoc=new ActiveXObject("Microsoft.XMLDOM") 

function IOx(U) {
    var X = !window.XMLHttpRequest ? new ActiveXObject('Microsoft.XMLHTTP') : new XMLHttpRequest;
    X.open('GET', U, false);
    X.setRequestHeader('Content-Type', 'text/xml')
    X.send('');
  return X.responseXML;
}


//var xmldoc=new ActiveXObject("Microsoft.XMLDOM") 
var xmldoc=IOx("lab 3.4.xml");



//xmldoc.async=false;
//xmldoc.load("lab 3.4.xml") // загружаем документ в память

function deleteTable()
{
	var table = document.getElementById("tbl");
	table.parentNode.removeChild(table);
	mainTable = -1;
}

function ReloadDoc(i_facultet, i_course, i_group, i_student)
{ 
	facultet = xmldoc.getElementsByTagName("facultet");
	// Удаление исходных
	count = document.getElementById("selectFacultet").length;
	for(i = 0; i < count; i++)
	{
		var x = document.getElementById("selectFacultet");
		x.remove(0);		
	}
	// Добавление
	for(i = 0; i < facultet.length; i++) 
	{
		var x = document.getElementById("selectFacultet");
		var option = document.createElement("option");
		option.value = i;
		if(i_facultet == i) option.selected = true;
		option.text = facultet.item(i).getAttribute("caption");
		x.add(option);	
	}
	course = facultet.item(i_facultet).getElementsByTagName("course");
	// Удаление исходных
	count = document.getElementById("selectCourse").length;
	for(i = 0; i < count; i++)
	{
		var x = document.getElementById("selectCourse");
		x.remove(0);		
	}
	// Добавление
	for(i = 0; i < course.length; i++) 
	{
		var x = document.getElementById("selectCourse");
		var option = document.createElement("option");
		option.value = i;
		if(i_course == i) option.selected = true;
		option.text = course.item(i).getAttribute("number");
		x.add(option);	
	}
	group = course.item(i_course).getElementsByTagName("group");
	// Удаление исходных
	count = document.getElementById("selectGroup").length;
	for(i = 0; i < count; i++)
	{
		var x = document.getElementById("selectGroup");
		x.remove(0);		
	}
	// Добавление
	for(i = 0; i < group.length; i++) 
	{
		var x = document.getElementById("selectGroup");
		var option = document.createElement("option");
		option.value = i;
		if(i_group == i) option.selected = true;
		option.text = group.item(i).getAttribute("number");
		x.add(option);	
	}
	student = group.item(i_group).getElementsByTagName("student");
	// Удаление исходных
	count = document.getElementById("selectStudent").length;
	for(i = 0; i < count; i++)
	{
		var x = document.getElementById("selectStudent");
		x.remove(0);		
	}
	// Добавление
	for(i = 0; i < student.length; i++) 
	{
		var x = document.getElementById("selectStudent");
		var option = document.createElement("option");
		option.value = i;
		if(i_student == i) option.selected = true;
		option.text = student.item(i).getAttribute("name");
		x.add(option);	
	}
	subject = student.item(i_student).getElementsByTagName("subject");
	
	if(mainTable != -1) deleteTable(mainTable);
    mainTable=document.createElement("table");//создаём новый элемент страницы (TABLE) 
    mainTable.border=1;//указывает толщину рамки таблицы 
    mainTable.id = "tbl";
	for(i = 0; i < subject.length; i++) 
	{
		var newRow=mainTable.insertRow(i); 
		
		var newCell = newRow.insertCell(0); 
		newCell.innerHTML = subject.item(i).getAttribute("title"); 

		for(j = 0; j < 3; j++)
		{
			var newCell = newRow.insertCell(-1);
			newCell.align="center";
			newCell.innerHTML="<input type = 'radio' disabled " + ((subject.item(i).text == j) ? "checked>" : ">");
		}
	}	
    var newRow=mainTable.insertRow(0);//добавляем строку в созданной таблице 
    var newCell = newRow.insertCell(0);//в созданной строке добавляем столбец 
    newCell.width="500";    
    newCell.align="center";
    newCell.innerHTML="<b>Предмет</b>";
    var newCell = newRow.insertCell(-1);//добавляем ещё один столбец 
    newCell.width="50";  
    newCell.align="center";
    newCell.innerHTML="<b>0</b>";
    var newCell = newRow.insertCell(-1);//добавляем ещё один столбец 
    newCell.width="50";  
    newCell.align="center";
    newCell.innerHTML="<b>1</b>";
    var newCell = newRow.insertCell(-1);//добавляем ещё один столбец 
    newCell.width="50";  
    newCell.align="center";
    newCell.innerHTML="<b>2</b>";		
	document.body.insertBefore(mainTable, buttonDo);
} 

function GetMiddleMark()
{
	var middleMark = 0;
	for(i = 0; i < subject.length; i++) middleMark += Number(subject.item(i).text);
	middleMark /= subject.length;
	return middleMark.toFixed(2);
}

 </script>

 </head>
 <body onLoad="ReloadDoc(0, 0, 0, 0)"> 
 Факультет: <select id = "selectFacultet" onChange = "ReloadDoc(selectFacultet.selectedIndex, 0, 0, 0);" ></select>Курс: <select id = "selectCourse" onChange = "ReloadDoc(selectFacultet.selectedIndex, selectCourse.selectedIndex, 0, 0);" ></select>Группа: <select id = "selectGroup" onChange = "ReloadDoc(selectFacultet.selectedIndex, selectCourse.selectedIndex, selectGroup.selectedIndex, 0);" ></select>ФИО: <select id = "selectStudent" onChange = "ReloadDoc(selectFacultet.selectedIndex, selectCourse.selectedIndex, selectGroup.selectedIndex, selectStudent.selectedIndex);" ></select>
 <br><input id = "buttonDo" type = "button" value = "Выполнить" onClick = "endValue.innerHTML = 'Средний балл за контрольный срок составляет: ' + GetMiddleMark()"><input type = "button" value = "Отменить" onClick = "endValue.innerHTML = ''">
 <br><span id = "endValue"></span>
 </body>
 </html>
